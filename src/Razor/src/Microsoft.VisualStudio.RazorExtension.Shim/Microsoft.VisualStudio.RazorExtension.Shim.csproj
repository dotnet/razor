<Project Sdk="Microsoft.NET.Sdk">
  <PropertyGroup>
    <TargetFramework>net472</TargetFramework>

    <!-- Use the RoslynDev Experimental instance so we can mingle with local builds of Roslyn -->
    <VSSDKTargetPlatformRegRootSuffix>RoslynDev</VSSDKTargetPlatformRegRootSuffix>

    <!-- Required to run the project localy -->
    <StartArguments>/rootsuffix $(VSSDKTargetPlatformRegRootSuffix) /log</StartArguments>

    <!-- Required to place the vsix in the right location by WTE MSI -->
    <ExtensionInstallationRoot>CommonExtensions</ExtensionInstallationRoot>
    <ExtensionInstallationFolder>Microsoft\RazorLanguageServices</ExtensionInstallationFolder>
    <IsProductComponent>true</IsProductComponent>
    <VisualStudioInsertionComponent>Microsoft.VisualStudio.RazorExtension</VisualStudioInsertionComponent>

    <!-- Don't automatically include dependencies -->
    <IncludePackageReferencesInVSIXContainer>false</IncludePackageReferencesInVSIXContainer>

    <!-- Update the VSToolsPath to ensure VSIX builds -->
    <VSToolsPath Condition="'$(VSToolsPath)' == ''">$(MSBuildExtensionsPath32)\Microsoft\VisualStudio\v$(VisualStudioVersion)</VSToolsPath>
    <ExcludeFromSourceBuild>true</ExcludeFromSourceBuild>
    <IsPackable>false</IsPackable>

    <GenerateResourceUsePreserializedResources Condition="'$(MSBuildRuntimeType)' == 'Core'">true</GenerateResourceUsePreserializedResources>

    <SetupProductArch>neutral</SetupProductArch>
    <ServiceHubCoreSubPath>ServiceHubCore</ServiceHubCoreSubPath>
    <!-- Cause the vsix to get deployed to the RootSuffix.
         Without this the Razor Extension won't be deployed for IntegrationTests
         to use in the "build.cmd" scenario -->
    <DeployExtension>true</DeployExtension>
  </PropertyGroup>

  <ItemGroup>
    <Content Include="Shim.txt">
      <CopyToOutputDirectory>PreserveNewest</CopyToOutputDirectory>
      <IncludeInVSIX>true</IncludeInVSIX>
    </Content>
  </ItemGroup>

  <ItemGroup>
    <None Include="source.extension.vsixmanifest">
      <SubType>Designer</SubType>
    </None>
  </ItemGroup>

  <ItemGroup>
    <ProjectReference Include="..\Microsoft.VisualStudio.RazorExtension\Microsoft.VisualStudio.RazorExtension.csproj" />
  </ItemGroup>

  <ItemGroup>
    <PackageReference Include="Microsoft.VisualStudio.LanguageServer.Protocol" Version="$(MicrosoftVisualStudioLanguageServerProtocolPackageVersion)" />
    <PackageReference Include="Microsoft.VisualStudio.LanguageServer.Protocol.Internal" Version="$(MicrosoftVisualStudioLanguageServerProtocolInternalPackageVersion)" />
    <PackageReference Include="Microsoft.VisualStudio.LanguageServer.Protocol.Extensions" Version="$(MicrosoftVisualStudioLanguageServerProtocolExtensionsPackageVersion)" />
  </ItemGroup>

  <ItemGroup>
    <RazorNgendVSIXSourceItem Include="$(OutputPath)Microsoft.VisualStudio.LanguageServer.Protocol.dll" />
    <RazorNgendVSIXSourceItem Include="$(OutputPath)Microsoft.VisualStudio.LanguageServer.Protocol.Internal.dll" />
    <RazorNgendVSIXSourceItem Include="$(OutputPath)Microsoft.VisualStudio.LanguageServer.Protocol.Extensions.dll" />

    <VSIXSourceItem Include="$(OutputPath)Microsoft.VisualStudio.LanguageServer.Protocol.dll" />
    <VSIXSourceItem Include="$(OutputPath)Microsoft.VisualStudio.LanguageServer.Protocol.Extensions.dll" />
    <VSIXSourceItem Include="$(OutputPath)Microsoft.VisualStudio.LanguageServer.Protocol.Internal.dll" />
  </ItemGroup>
</Project>