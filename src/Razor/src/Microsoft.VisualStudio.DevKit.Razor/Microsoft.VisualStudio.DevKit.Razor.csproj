<Project Sdk="Microsoft.NET.Sdk">

  <PropertyGroup>
    <TargetFrameworks>$(DefaultNetCoreTargetFrameworks)</TargetFrameworks>
    <PublishTargetFramework>net7.0</PublishTargetFramework>
    <Description>Razor is a markup syntax for adding server-side logic to web pages. This package contains the language server assets for C# DevKit.</Description>
    <EnableApiCheck>false</EnableApiCheck>
    <IsShippingPackage>false</IsShippingPackage>
    <RemoveDevicePlatformSupport>true</RemoveDevicePlatformSupport>
    <SelfContained>false</SelfContained>
  </PropertyGroup>

  <ItemGroup>
    <Compile Include="..\Microsoft.VisualStudio.Editor.Razor\Telemetry\TelemetryReporter.cs" Link="Telemetry\TelemetryReporter.cs" />
  </ItemGroup>

  <ItemGroup>
    <PackageReference Include="Microsoft.VisualStudio.Telemetry" Version="$(MicrosoftVisualStudioTelemetryVersion)" />
  </ItemGroup>

  <ItemGroup>
    <Content Include="$(RepositoryRoot)NOTICE.txt">
      <CopyToOutputDirectory>PreserveNewest</CopyToOutputDirectory>
    </Content>
  </ItemGroup>

  <ItemGroup>
    <ProjectReference Include="..\Microsoft.AspNetCore.Razor.ProjectEngineHost\Microsoft.AspNetCore.Razor.ProjectEngineHost.csproj" PrivateAssets="all" />
  </ItemGroup>

  <!--
    Technique for publishing multiple RIDs from
    https://github.com/dotnet/cli/issues/9221#issuecomment-387512008
    Example usage:
     dotnet msbuild -restore -t:PublishAllRids -p:Configuration=Release
  -->
  <PropertyGroup>
    <MSBuildAllProjects>$(MSBuildAllProjects);$(MSBuildThisFileFullPath)</MSBuildAllProjects>

    <!-- Enable roll-forward to latest patch.  This allows one restore operation
        to apply to all of the self-contained publish operations. -->
    <TargetLatestRuntimePatch>true</TargetLatestRuntimePatch>
    <RidsPublishDir>$(ArtifactsDir)DevKitTelemetry\$(Configuration)\</RidsPublishDir>
  </PropertyGroup>

  <Target Name="PublishAllRids">
    <ItemGroup>
      <ProjectToPublish Include="$(MSBuildProjectFullPath)">
        <AdditionalProperties>RuntimeIdentifier=;PublishDir=$(RidsPublishDir);TargetFramework=$(PublishTargetFramework);SelfContained=false</AdditionalProperties>
      </ProjectToPublish>

      <ProjectToPublish_PlatformAgnostic Include="$(MSBuildProjectFullPath)">
        <AdditionalProperties>PublishDir=$(RidsPublishDir)\PlatformAgnostic\;UseAppHost=false;TargetFramework=$(PublishTargetFramework);SelfContained=false</AdditionalProperties>
      </ProjectToPublish_PlatformAgnostic>
    </ItemGroup>

    <MSBuild Projects="@(ProjectToPublish)" Targets="Publish" BuildInParallel="false" />
    <MSBuild Projects="@(ProjectToPublish_PlatformAgnostic)" Targets="Publish" BuildInParallel="false" Condition="'$(OS)' == 'WINDOWS_NT'" />
  </Target>
</Project>
