<!--
***********************************************************************************************
Microsoft.CSharpExtension.DesignTime.targets

A polyfill for the real Microsoft.CSharp.DesignTime.targets file that is supplied by the .NET
project system in Visual Studio and the C# Dev Kit extension.
https://github.com/dotnet/project-system/blob/8ba13c7fa917b86462e0ff32a07ef3e15eb8dfa6/src/Microsoft.VisualStudio.ProjectSystem.Managed/ProjectSystem/DesignTimeTargets/Microsoft.CSharp.DesignTime.targets

WARNING:  DO NOT MODIFY this file unless you are knowledgeable about MSBuild and have
          created a backup copy.  Incorrect changes to this file will make it
          impossible to load or build your projects from the command-line or the IDE.

Copyright (c) .NET Foundation. All rights reserved.
***********************************************************************************************
-->

<Project>

  <!-- Razor cohosting support for projects that don't use the Razor SDK -->

  <!--
    If there are any .razor or .cshtml files in this project we want to do three things:

      1. Add a 'RazorWithoutSdk' capability to the project so tooling can light up as necessary
      2. Reference the Razor source generator
      3. Add each .razor and .cshtml file to the project as an AdditionalFiles item so the source generator can see it
  -->

  <!-- .NET Framework uses a different editor in VS -->
 <Target Name="DetectRazorOrCshtmlFiles" BeforeTargets="AssignProjectConfiguration" Condition="'$(UsingMicrosoftNETSdkRazor)' != 'true'">
    <ItemGroup>
      <!-- Collect all Razor and CSHTML files -->
      <_RazorOrCshtmlFiles Include="**\*.razor;**\*.cshtml" />
    </ItemGroup>

    <!-- Add a capability to control initialization of Razor in the IDE -->
    <ItemGroup Condition="'@(_RazorOrCshtmlFiles)' != ''">
      <ProjectCapability Include="RazorWithoutSdk" />
    </ItemGroup>

    <!-- As a get out of jail card, we let users turn off anything impactful, but their IDE won't really work. -->
    <ItemGroup Condition="'$(DisableAllRazorFilesAsAdditionalFiles)' != 'true' And '@(_RazorOrCshtmlFiles)' != ''">
      <AdditionalFiles Include="@(_RazorOrCshtmlFiles)" />
    </ItemGroup>

    <ItemGroup Condition="'$(DisableAutomaticRazorSourceGeneratorReference)' != 'true' And '@(_RazorOrCshtmlFiles)' != ''">
      <!-- Our analyzer loader will redirect DLL loads to the right place for tooling, as long as the right filename is referenced -->
      <Analyzer Include="Microsoft.CodeAnalysis.Razor.Compiler.dll" />
    </ItemGroup>
  </Target>

</Project>